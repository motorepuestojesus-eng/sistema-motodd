<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SISTEMA POS INTELIGENTE | Franquicia Pro</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --bg: #0f172a; --card: #1e293b; --accent: #38bdf8; --success: #22c55e;
            --danger: #ef4444; --text: #f8fafc; --muted: #94a3b8;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }
        body { background: var(--bg); color: var(--text); display: flex; height: 100vh; overflow: hidden; }

        /* Navegación */
        .sidebar { width: 260px; background: var(--card); border-right: 1px solid #334155; display: flex; flex-direction: column; }
        .logo { padding: 25px; font-weight: 800; font-size: 1.2rem; color: var(--accent); border-bottom: 1px solid #334155; }
        .nav-btn { padding: 15px 25px; color: var(--muted); cursor: pointer; border: none; background: none; width: 100%; text-align: left; display: flex; align-items: center; gap: 12px; font-size: 1rem; }
        .nav-btn.active { background: #334155; color: white; border-left: 4px solid var(--accent); }

        /* Contenido */
        .main { flex-grow: 1; padding: 25px; overflow-y: auto; }
        .page { display: none; }
        .page.active { display: block; }
        .card { background: var(--card); padding: 20px; border-radius: 12px; border: 1px solid #334155; margin-bottom: 20px; }

        /* BUSCADORES INTELIGENTES */
        .search-container { position: relative; width: 100%; }
        .results-dropdown { 
            position: absolute; top: 100%; left: 0; right: 0; 
            background: #2d3748; border: 1px solid var(--accent); 
            z-index: 1000; border-radius: 0 0 8px 8px; 
            max-height: 250px; overflow-y: auto; display: none; 
        }
        .result-item { padding: 12px; cursor: pointer; border-bottom: 1px solid #4a5568; transition: 0.2s; }
        .result-item:hover { background: var(--accent); color: var(--bg); }

        /* Form Estilos */
        input { width: 100%; padding: 12px; background: #0f172a; border: 1px solid #334155; color: white; border-radius: 8px; margin-top: 5px; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .btn { padding: 12px 20px; border-radius: 8px; border: none; cursor: pointer; font-weight: 700; transition: 0.2s; }
        .btn-primary { background: var(--accent); color: var(--bg); }
        .btn-success { background: var(--success); color: white; width: 100%; font-size: 1.1rem; }

        /* Carrito */
        .cart-table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        .cart-table th { color: var(--muted); font-size: 0.8rem; text-align: left; padding: 10px; border-bottom: 1px solid #334155; }
        .cart-table td { padding: 12px 10px; border-bottom: 1px solid #334155; }

        .total-box { margin-top: 20px; padding-top: 15px; border-top: 2px solid var(--accent); text-align: right; }
        .total-box h2 { color: var(--accent); font-size: 2rem; }
    </style>
</head>
<body>

    <div class="sidebar">
        <div class="logo"><i class="fas fa-shopping-basket"></i> GLOBAL SYSTEM</div>
        <button class="nav-btn active" onclick="tab('pos')"><i class="fas fa-cash-register"></i> Ventas</button>
        <button class="nav-btn" onclick="tab('clientes')"><i class="fas fa-user-tag"></i> Clientes</button>
        <button class="nav-btn" onclick="tab('stock')"><i class="fas fa-box-open"></i> Inventario</button>
    </div>

    <main class="main">
        <div id="page-pos" class="page active">
            <div class="grid" style="grid-template-columns: 1.2fr 0.8fr;">
                
                <div class="card">
                    <h3><i class="fas fa-search"></i> Buscar Producto</h3>
                    <p style="font-size: 0.8rem; color: var(--muted); margin-bottom: 10px;">Busca por Nombre o Marca (Ej: Harina Pan)</p>
                    <div class="search-container">
                        <input type="text" id="input-prod" placeholder="Escribe nombre del producto o marca..." onkeyup="buscarProductoPredictivo(this.value)">
                        <div id="res-prod" class="results-dropdown"></div>
                    </div>

                    <table class="cart-table">
                        <thead>
                            <tr><th>Producto</th><th>Cant.</th><th>Precio</th><th>Subtotal</th><th></th></tr>
                        </thead>
                        <tbody id="cart-items"></tbody>
                    </table>
                </div>

                <div class="card">
                    <h3><i class="fas fa-user-check"></i> Datos del Cliente</h3>
                    <div class="search-container">
                        <input type="text" id="input-cedula" placeholder="Ingresa Cédula para validar..." onkeyup="buscarClientePredictivo(this.value)">
                        <div id="res-cli" class="results-dropdown"></div>
                    </div>

                    <div id="info-cliente-confirmado" style="margin-top: 15px; padding: 15px; background: #0f172a; border-radius: 8px; display: none; border-left: 4px solid var(--success);">
                        <b id="v-nombre">Cargando...</b><br>
                        <small id="v-tel"></small><br>
                        <small id="v-dir"></small>
                    </div>

                    <div class="total-box">
                        <p>Total a Pagar:</p>
                        <h2 id="v-total">$0.00</h2>
                        <button class="btn btn-success" style="margin-top: 15px;" onclick="procesarPago()">FINALIZAR VENTA (F10)</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="page-clientes" class="page">
            <div class="card">
                <h2>Registrar Nuevo Cliente</h2>
                <div class="grid" style="margin-top:15px;">
                    <input type="text" id="reg-cedula" placeholder="Cédula">
                    <input type="text" id="reg-nombre" placeholder="Nombre y Apellido">
                    <input type="text" id="reg-tel" placeholder="Teléfono">
                    <input type="text" id="reg-dir" placeholder="Dirección Completa">
                </div>
                <button class="btn btn-primary" style="margin-top:15px;" onclick="guardarCliente()">Guardar en Base de Datos</button>
            </div>
        </div>

        <div id="page-stock" class="page">
            <div class="card">
                <h2>Agregar Producto al Inventario</h2>
                <div class="grid" style="margin-top:15px;">
                    <input type="text" id="p-nombre" placeholder="Nombre (Ej: Harina de Maíz)">
                    <input type="text" id="p-marca" placeholder="Marca (Ej: PAN)">
                    <input type="number" id="p-precio" placeholder="Precio ($)">
                    <input type="number" id="p-stock" placeholder="Cantidad en Stock">
                </div>
                <button class="btn btn-primary" style="margin-top:15px;" onclick="guardarProducto()">Cargar al Sistema</button>
            </div>
        </div>

    </main>

    <script>
        // --- DATOS ---
        let db = {
            clientes: JSON.parse(localStorage.getItem('g_cli')) || [],
            productos: JSON.parse(localStorage.getItem('g_pro')) || [],
            carrito: [],
            clienteSeleccionado: null
        };

        function tab(t) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            document.getElementById('page-'+t).classList.add('active');
            event.currentTarget.classList.add('active');
        }

        // --- LÓGICA DE BÚSQUEDA DE CLIENTE ---
        function buscarClientePredictivo(val) {
            const res = document.getElementById('res-cli');
            if(val.length < 2) { res.style.display = 'none'; return; }

            const m = db.clientes.filter(c => c.cedula.includes(val));
            if(m.length > 0) {
                res.innerHTML = m.map(c => `
                    <div class="result-item" onclick="confirmarCliente('${c.cedula}')">
                        <i class="fas fa-user"></i> ${c.nombre} (ID: ${c.cedula})
                    </div>
                `).join('');
                res.style.display = 'block';
            } else {
                res.innerHTML = `<div class="result-item" onclick="tab('clientes')">❌ No existe. Clic para registrar</div>`;
                res.style.display = 'block';
            }
        }

        function confirmarCliente(cedula) {
            const c = db.clientes.find(x => x.cedula === cedula);
            db.clienteSeleccionado = c;
            document.getElementById('res-cli').style.display = 'none';
            document.getElementById('input-cedula').value = c.cedula;
            
            document.getElementById('info-cliente-confirmado').style.display = 'block';
            document.getElementById('v-nombre').innerText = c.nombre;
            document.getElementById('v-tel').innerText = "Telf: " + c.tel;
            document.getElementById('v-dir').innerText = "Dir: " + c.dir;
        }

        // --- LÓGICA DE BÚSQUEDA DE PRODUCTO ---
        function buscarProductoPredictivo(val) {
            const res = document.getElementById('res-prod');
            if(val.length < 1) { res.style.display = 'none'; return; }

            const m = db.productos.filter(p => 
                p.nombre.toLowerCase().includes(val.toLowerCase()) || 
                p.marca.toLowerCase().includes(val.toLowerCase())
            );

            if(m.length > 0) {
                res.innerHTML = m.map(p => `
                    <div class="result-item" onclick="agregarAlCarrito(${p.id})">
                        <b>${p.nombre}</b> - <small>${p.marca}</small> 
                        <span style="float:right; color:var(--accent)">$${p.precio} (Stock: ${p.stock})</span>
                    </div>
                `).join('');
                res.style.display = 'block';
            } else {
                res.style.display = 'none';
            }
        }

        function agregarAlCarrito(id) {
            const p = db.productos.find(x => x.id === id);
            if(p.stock <= 0) return alert("¡Sin existencias!");

            const item = db.carrito.find(x => x.id === id);
            if(item) item.cant++;
            else db.carrito.push({...p, cant: 1});

            document.getElementById('res-prod').style.display = 'none';
            document.getElementById('input-prod').value = '';
            renderCarrito();
        }

        function renderCarrito() {
            const t = document.getElementById('cart-items');
            t.innerHTML = '';
            let total = 0;
            db.carrito.forEach((item, i) => {
                const sub = item.precio * item.cant;
                total += sub;
                t.innerHTML += `
                    <tr>
                        <td>${item.nombre} <br><small>${item.marca}</small></td>
                        <td>${item.cant}</td>
                        <td>$${item.precio}</td>
                        <td>$${sub.toFixed(2)}</td>
                        <td><i class="fas fa-trash" style="color:var(--danger); cursor:pointer" onclick="db.carrito.splice(${i},1);renderCarrito()"></i></td>
                    </tr>
                `;
            });
            document.getElementById('v-total').innerText = `$${total.toFixed(2)}`;
        }

        // --- GUARDADO DE DATOS ---
        function guardarCliente() {
            const c = {
                cedula: document.getElementById('reg-cedula').value,
                nombre: document.getElementById('reg-nombre').value,
                tel: document.getElementById('reg-tel').value,
                dir: document.getElementById('reg-dir').value
            };
            db.clientes.push(c);
            localStorage.setItem('g_cli', JSON.stringify(db.clientes));
            alert("Cliente afiliado correctamente");
            tab('pos');
        }

        function guardarProducto() {
            const p = {
                id: Date.now(),
                nombre: document.getElementById('p-nombre').value,
                marca: document.getElementById('p-marca').value,
                precio: parseFloat(document.getElementById('p-precio').value),
                stock: parseInt(document.getElementById('p-stock').value)
            };
            db.productos.push(p);
            localStorage.setItem('g_pro', JSON.stringify(db.productos));
            alert("Producto añadido al sistema");
            document.getElementById('p-nombre').value = '';
        }

        function procesarPago() {
            if(db.carrito.length === 0) return alert("El carrito está vacío");
            if(!db.clienteSeleccionado) return alert("Debe seleccionar un cliente antes de cobrar");

            // Descontar stock real
            db.carrito.forEach(c => {
                const p = db.productos.find(x => x.id === c.id);
                p.stock -= c.cant;
            });

            localStorage.setItem('g_pro', JSON.stringify(db.productos));
            alert("Venta procesada con éxito para: " + db.clienteSeleccionado.nombre);
            db.carrito = [];
            db.clienteSeleccionado = null;
            location.reload(); // Reiniciar para nueva venta
        }
    </script>
</body>
</html>

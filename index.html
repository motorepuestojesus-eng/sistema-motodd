<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SISTEMA POS FRANQUICIA V8.0</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --bg: #0f172a; --card: #1e293b; --accent: #38bdf8; 
            --success: #22c55e; --danger: #ef4444; --text: #f8fafc;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }
        body { background: var(--bg); color: var(--text); display: flex; height: 100vh; overflow: hidden; }

        /* Sidebar Navegación */
        .sidebar { width: 250px; background: var(--card); border-right: 1px solid #334155; display: flex; flex-direction: column; }
        .logo { padding: 25px; font-weight: 800; color: var(--accent); border-bottom: 1px solid #334155; text-align: center; }
        .nav-link { padding: 15px 25px; color: #94a3b8; cursor: pointer; border: none; background: none; width: 100%; text-align: left; display: flex; align-items: center; gap: 12px; transition: 0.3s; }
        .nav-link:hover, .nav-link.active { background: #334155; color: white; border-left: 4px solid var(--accent); }

        /* Contenido */
        .main { flex-grow: 1; padding: 25px; overflow-y: auto; }
        .page { display: none; }
        .page.active { display: block; }
        .card { background: var(--card); padding: 20px; border-radius: 12px; border: 1px solid #334155; margin-bottom: 20px; }

        /* Buscadores Predictivos */
        .search-container { position: relative; margin-bottom: 15px; }
        input, select { width: 100%; padding: 12px; background: #0f172a; border: 1px solid #334155; color: white; border-radius: 8px; font-size: 1rem; }
        .dropdown { position: absolute; top: 100%; left: 0; right: 0; background: #1e293b; border: 1px solid var(--accent); z-index: 100; border-radius: 0 0 8px 8px; max-height: 200px; overflow-y: auto; display: none; }
        .drop-item { padding: 10px; cursor: pointer; border-bottom: 1px solid #334155; transition: 0.2s; }
        .drop-item:hover { background: var(--accent); color: #000; }

        /* POS Layout */
        .pos-grid { display: grid; grid-template-columns: 1fr 400px; gap: 20px; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th { text-align: left; color: #94a3b8; font-size: 0.8rem; padding: 10px; border-bottom: 1px solid #334155; }
        td { padding: 12px 10px; border-bottom: 1px solid #334155; }

        .client-info-box { background: #0f172a; padding: 15px; border-radius: 8px; margin-top: 10px; border-left: 4px solid var(--success); display: none; }
        .total-display { font-size: 2.5rem; font-weight: 800; color: var(--accent); margin: 15px 0; }
        .btn { padding: 12px 20px; border-radius: 8px; border: none; cursor: pointer; font-weight: 700; width: 100%; }
        .btn-pay { background: var(--success); color: white; font-size: 1.2rem; }
        .btn-excel { background: #1d6f42; color: white; width: auto; margin-bottom: 20px; }
    </style>
</head>
<body>

    <div class="sidebar">
        <div class="logo"><i class="fas fa-store"></i> FRANQUICIA PRO</div>
        <button class="nav-link active" onclick="showTab('tab-pos')"><i class="fas fa-cash-register"></i> CAJA (VENTAS)</button>
        <button class="nav-link" onclick="showTab('tab-clientes')"><i class="fas fa-user-plus"></i> REGISTRO CLIENTES</button>
        <button class="nav-link" onclick="showTab('tab-inventario')"><i class="fas fa-boxes"></i> INVENTARIO</button>
        <button class="nav-link" onclick="showTab('tab-consolidado')"><i class="fas fa-chart-line"></i> CONSOLIDADO</button>
    </div>

    <main class="main">
        <div id="tab-pos" class="page active">
            <div class="pos-grid">
                <div class="card">
                    <h3><i class="fas fa-barcode"></i> Buscar por Nombre o Marca</h3>
                    <div class="search-container">
                        <input type="text" id="p-search" placeholder="Ej: Arroz o Marca Polar..." onkeyup="buscarProd(this.value)">
                        <div id="p-res" class="dropdown"></div>
                    </div>
                    <table>
                        <thead><tr><th>Producto</th><th>Cant.</th><th>Precio</th><th>Subtotal</th><th></th></tr></thead>
                        <tbody id="cart-items"></tbody>
                    </table>
                </div>

                <div class="card">
                    <h3><i class="fas fa-id-card"></i> Cédula del Cliente</h3>
                    <div class="search-container">
                        <input type="text" id="c-search" placeholder="Escriba cédula..." onkeyup="buscarCli(this.value)">
                        <div id="c-res" class="dropdown"></div>
                    </div>
                    <div id="cli-box" class="client-info-box">
                        <b id="cli-nom"></b><br>
                        <small id="cli-det"></small>
                    </div>

                    <h3 style="margin-top:20px;">Método de Pago</h3>
                    <select id="pay-method">
                        <option value="Divisa">DIVISA ($)</option>
                        <option value="Efectivo Bs">EFECTIVO (Bs)</option>
                        <option value="Punto de Venta">PUNTO DE VENTA</option>
                        <option value="Pago Movil">PAGO MÓVIL</option>
                    </select>

                    <div style="text-align: center; margin-top: 30px;">
                        <p>Total a Pagar:</p>
                        <div class="total-display" id="cart-total">$0.00</div>
                        <button class="btn btn-pay" onclick="procesarPago()">COBRAR E IMPRIMIR</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="tab-clientes" class="page">
            <div class="card">
                <h2>Registrar Cliente Nuevo</h2>
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px;">
                    <input type="text" id="reg-ced" placeholder="Cédula / RIF">
                    <input type="text" id="reg-nom" placeholder="Nombre Completo">
                    <input type="text" id="reg-tel" placeholder="Teléfono">
                    <input type="text" id="reg-dir" placeholder="Dirección">
                </div>
                <button class="btn btn-pay" style="margin-top: 20px; background: var(--accent); color: #000;" onclick="addCliente()">GUARDAR CLIENTE</button>
            </div>
        </div>

        <div id="tab-inventario" class="page">
            <div class="card">
                <h2>Añadir Producto</h2>
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px;">
                    <input type="text" id="inv-nom" placeholder="Nombre (Ej: Arroz Blanco)">
                    <input type="text" id="inv-mar" placeholder="Marca (Ej: Primor)">
                    <input type="number" id="inv-pre" placeholder="Precio ($)">
                    <input type="number" id="inv-sto" placeholder="Stock Inicial">
                </div>
                <button class="btn btn-pay" style="margin-top: 20px; background: var(--accent); color: #000;" onclick="addProducto()">AÑADIR AL STOCK</button>
            </div>
        </div>

        <div id="tab-consolidado" class="page">
            <div style="display: flex; justify-content: space-between;">
                <h2>Reporte de Ventas del Día</h2>
                <button class="btn btn-excel" onclick="exportarExcel()"><i class="fas fa-file-excel"></i> DESCARGAR EXCEL (CSV)</button>
            </div>
            <div class="card">
                <table>
                    <thead><tr><th>Fecha/Hora</th><th>Cliente</th><th>Metodo</th><th>Total</th></tr></thead>
                    <tbody id="report-body"></tbody>
                </table>
            </div>
        </div>
    </main>

    <script>
        // --- BASE DE DATOS LOCAL ---
        let db = {
            clientes: JSON.parse(localStorage.getItem('pos_cli')) || [],
            productos: JSON.parse(localStorage.getItem('pos_pro')) || [],
            ventas: JSON.parse(localStorage.getItem('pos_ven')) || [],
            carrito: [],
            cliActivo: null
        };

        function showTab(id) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            event.currentTarget.classList.add('active');
            renderVentas();
        }

        // --- BÚSQUEDA DE CLIENTE ---
        function buscarCli(val) {
            const res = document.getElementById('c-res');
            if(!val) { res.style.display = 'none'; return; }
            const matches = db.clientes.filter(c => c.cedula.includes(val));
            res.innerHTML = matches.map(c => `<div class="drop-item" onclick="confirmarCli('${c.cedula}')"><b>${c.cedula}</b> - ${c.nombre}</div>`).join('');
            res.style.display = matches.length ? 'block' : 'none';
        }

        function confirmarCli(ced) {
            db.cliActivo = db.clientes.find(c => c.cedula === ced);
            document.getElementById('c-search').value = ced;
            document.getElementById('cli-box').style.display = 'block';
            document.getElementById('cli-nom').innerText = db.cliActivo.nombre;
            document.getElementById('cli-det').innerText = `Tel: ${db.cliActivo.tel} | Dir: ${db.cliActivo.dir}`;
            document.getElementById('c-res').style.display = 'none';
        }

        // --- BÚSQUEDA DE PRODUCTO ---
        function buscarProd(val) {
            const res = document.getElementById('p-res');
            if(!val) { res.style.display = 'none'; return; }
            const matches = db.productos.filter(p => p.nombre.toLowerCase().includes(val.toLowerCase()) || p.marca.toLowerCase().includes(val.toLowerCase()));
            res.innerHTML = matches.map(p => `
                <div class="drop-item" onclick="agregarItem(${p.id})">
                    <b>${p.nombre}</b> (${p.marca}) - <span style="color:var(--accent)">$${p.precio}</span> <small>[Stock: ${p.stock}]</small>
                </div>
            `).join('');
            res.style.display = matches.length ? 'block' : 'none';
        }

        function agregarItem(id) {
            const p = db.productos.find(x => x.id === id);
            if(p.stock <= 0) return alert("Sin existencias");
            const existe = db.carrito.find(x => x.id === id);
            if(existe) existe.cant++; else db.carrito.push({...p, cant: 1});
            document.getElementById('p-search').value = '';
            document.getElementById('p-res').style.display = 'none';
            renderCarrito();
        }

        function renderCarrito() {
            const body = document.getElementById('cart-items');
            body.innerHTML = '';
            let t = 0;
            db.carrito.forEach((item, idx) => {
                const sub = item.precio * item.cant;
                t += sub;
                body.innerHTML += `<tr>
                    <td>${item.nombre}<br><small>${item.marca}</small></td>
                    <td>${item.cant}</td>
                    <td>$${item.precio}</td>
                    <td>$${sub.toFixed(2)}</td>
                    <td><i class="fas fa-trash" style="color:var(--danger);cursor:pointer" onclick="db.carrito.splice(${idx},1);renderCarrito()"></i></td>
                </tr>`;
            });
            document.getElementById('cart-total').innerText = `$${t.toFixed(2)}`;
        }

        // --- PROCESOS ---
        function addCliente() {
            db.clientes.push({
                cedula: document.getElementById('reg-ced').value,
                nombre: document.getElementById('reg-nom').value,
                tel: document.getElementById('reg-tel').value,
                dir: document.getElementById('reg-dir').value
            });
            save(); alert("Cliente guardado");
        }

        function addProducto() {
            db.productos.push({
                id: Date.now(),
                nombre: document.getElementById('inv-nom').value,
                marca: document.getElementById('inv-mar').value,
                precio: parseFloat(document.getElementById('inv-pre').value),
                stock: parseInt(document.getElementById('inv-sto').value)
            });
            save(); alert("Producto añadido");
        }

        function procesarPago() {
            if(!db.cliActivo) return alert("Seleccione un cliente");
            if(db.carrito.length === 0) return alert("Carrito vacío");

            const venta = {
                fecha: new Date().toLocaleString(),
                cliente: db.cliActivo.nombre,
                metodo: document.getElementById('pay-method').value,
                total: document.getElementById('cart-total').innerText
            };

            db.carrito.forEach(item => {
                const p = db.productos.find(x => x.id === item.id);
                p.stock -= item.cant;
            });

            db.ventas.push(venta);
            db.carrito = [];
            db.cliActivo = null;
            save();
            alert("¡Venta Exitosa!");
            location.reload();
        }

        function save() {
            localStorage.setItem('pos_cli', JSON.stringify(db.clientes));
            localStorage.setItem('pos_pro', JSON.stringify(db.productos));
            localStorage.setItem('pos_ven', JSON.stringify(db.ventas));
        }

        function renderVentas() {
            document.getElementById('report-body').innerHTML = db.ventas.map(v => `
                <tr><td>${v.fecha}</td><td>${v.cliente}</td><td>${v.metodo}</td><td>${v.total}</td></tr>
            `).join('');
        }

        function exportarExcel() {
            let csv = "Fecha,Cliente,Metodo,Total\n";
            db.ventas.forEach(v => csv += `${v.fecha},${v.cliente},${v.metodo},${v.total.replace('$','')}\n`);
            const blob = new Blob([csv], { type: 'text/csv' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = 'consolidado_ventas.csv';
            a.click();
        }

        renderVentas();
    </script>
</body>
</html>

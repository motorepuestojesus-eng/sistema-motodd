<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Moto Repuestos Jesús - Sistema Integral v22</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body { background: linear-gradient(135deg, #1e3a8a 0%, #7c3aed 100%); min-height: 100vh; font-family: 'Poppins', sans-serif; }
        .glass { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); border-radius: 2rem; border: 1px solid rgba(255, 255, 255, 0.2); }
        .table-rainbow th { background: linear-gradient(90deg, #4f46e5, #ec4899); color: white; padding: 10px; font-size: 10px; text-transform: uppercase; }
        .table-rainbow td { padding: 4px; border-bottom: 1px solid #f0f0f0; }
        .input-glow:focus { background: rgba(79, 70, 229, 0.1); outline: none; box-shadow: inset 0 0 0 2px #4f46e5; border-radius: 4px; }
        .card-red { background: linear-gradient(135deg, #fecaca 0%, #fca5a5 100%); }
        .card-green { background: linear-gradient(135deg, #bbf7d0 0%, #86efac 100%); }
        .card-blue { background: linear-gradient(135deg, #bae6fd 0%, #7dd3fc 100%); }
        input { background: transparent; text-align: center; outline: none; width: 100%; font-weight: 600; font-size: 13px; }
        .tab-btn { transition: 0.3s; border-bottom: 3px solid transparent; opacity: 0.6; }
        .tab-btn.active { opacity: 1; border-bottom: 3px solid #4f46e5; color: #1e3a8a; font-weight: 800; }
        .page { display: none; }
        .page.active { display: block; }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">
</head>
<body class="p-4 md:p-6">

    <div class="max-w-[1500px] mx-auto glass shadow-2xl overflow-hidden">
        
        <div class="p-6 flex flex-col md:flex-row justify-between items-center gap-4">
            <div>
                <h1 class="text-3xl font-black text-indigo-900 italic uppercase tracking-tighter">Moto Repuestos Jesús</h1>
                <div class="flex gap-4 mt-2">
                    <button onclick="switchTab('caja')" id="tab-caja" class="tab-btn active text-xs uppercase font-bold px-2 py-1">Cuadre Diario</button>
                    <button onclick="switchTab('inv')" id="tab-inv" class="tab-btn text-xs uppercase font-bold px-2 py-1">Inventario</button>
                </div>
            </div>
            <div class="flex gap-4">
                <div class="bg-indigo-600 p-2 rounded-xl text-white text-center shadow-lg">
                    <span class="text-[9px] font-bold opacity-80 uppercase">Tasa BCV</span>
                    <input type="number" id="tasa" step="0.01" value="54.20" class="text-xl font-black w-20 text-white" onchange="calcular()">
                </div>
                <button onclick="limpiarTodo()" class="bg-red-500 text-white px-4 py-2 rounded-xl font-black text-xs uppercase shadow-md">
                    <i class="fas fa-trash-alt mr-1"></i> Reiniciar
                </button>
            </div>
        </div>

        <div id="page-caja" class="page active p-6 pt-0">
            <div class="bg-white rounded-2xl shadow-lg overflow-hidden border border-gray-100 mb-6">
                <table class="table-rainbow w-full">
                    <thead>
                        <tr>
                            <th>Factura</th><th>Cédula (7-8)</th><th>Cliente</th><th>$ Efectivo</th><th>Bs Efectivo</th><th>Débito</th><th>Pago Móvil</th><th class="bg-pink-500">Sub-Total Bs</th><th class="bg-indigo-800 font-black">Total $</th>
                        </tr>
                    </thead>
                    <tbody id="cuerpoVentas"></tbody>
                    <tfoot class="bg-indigo-50 font-black text-indigo-900">
                        <tr id="pieVentas"></tr>
                    </tfoot>
                </table>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <div class="card-blue p-5 rounded-3xl shadow-md text-blue-900">
                    <h3 class="font-black uppercase text-[10px] mb-3 flex items-center"><i class="fas fa-clock mr-2"></i> Cuentas por Cobrar</h3>
                    <div class="space-y-2" id="seccionCuentas"></div>
                    <div class="mt-3 pt-2 border-t border-blue-400 flex justify-between font-black text-xs">
                        <span>PENDIENTE TOTAL:</span><span id="totalCuentas">0.00</span>
                    </div>
                </div>

                <div class="card-red p-5 rounded-3xl shadow-md text-red-900">
                    <h3 class="font-black uppercase text-[10px] mb-3 italic">Gastos / Egresos (Bs)</h3>
                    <div class="space-y-2" id="seccionGastos"></div>
                    <h3 class="font-black uppercase text-[10px] my-3 italic text-green-800 border-t border-red-300 pt-3">Otros Ingresos (Bs)</h3>
                    <div class="space-y-2" id="seccionOtrosIngresos"></div>
                    <div class="mt-3 pt-2 border-t border-red-300 flex justify-between font-black text-xs">
                        <span>NETO OTROS (Bs):</span><span id="totalNetoOtros">0.00</span>
                    </div>
                </div>

                <div class="bg-slate-900 p-6 rounded-3xl shadow-2xl flex flex-col items-center justify-center text-center text-white border border-indigo-500/30">
                    <span class="text-[9px] font-black uppercase tracking-widest text-indigo-400 mb-2 italic">Diferencia $ (Físico vs Sistema)</span>
                    <div id="statusNum" class="text-6xl font-black mb-1">0.00</div>
                    <div id="statusTxt" class="text-[10px] font-bold uppercase italic text-gray-400">Cuadrando...</div>
                    <div class="mt-4 w-full bg-indigo-950 p-3 rounded-2xl border border-indigo-800">
                        <h4 class="text-[9px] font-bold text-indigo-300 uppercase mb-2 italic">Conteo Billetes Físico $</h4>
                        <div id="billetes" class="grid grid-cols-2 gap-x-4 gap-y-1 text-[10px]"></div>
                        <div class="mt-2 pt-2 border-t border-indigo-800 flex justify-between text-xs font-black">
                            <span>TOTAL FÍSICO:</span><span id="resFisico" class="text-indigo-300">0.00</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="page-inv" class="page p-6 pt-0">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                <div class="bg-white p-6 rounded-3xl shadow-lg border border-indigo-100 col-span-1">
                    <h2 class="font-black text-indigo-900 uppercase text-sm mb-4 italic">Nuevo Producto</h2>
                    <div class="space-y-4">
                        <div><label class="text-[9px] font-bold text-indigo-400 uppercase">Proveedor</label><input type="text" id="p-prov" class="input-glow border-b border-indigo-200 py-1 text-left"></div>
                        <div><label class="text-[9px] font-bold text-indigo-400 uppercase">Marca</label><input type="text" id="p-marca" class="input-glow border-b border-indigo-200 py-1 text-left"></div>
                        <div><label class="text-[9px] font-bold text-indigo-400 uppercase">Modelo</label><input type="text" id="p-modelo" class="input-glow border-b border-indigo-200 py-1 text-left"></div>
                        <div><label class="text-[9px] font-bold text-indigo-400 uppercase">Precio Venta ($)</label><input type="number" id="p-precio" class="input-glow border-b border-indigo-200 py-1 text-left"></div>
                        <button onclick="agregarProducto()" class="w-full bg-indigo-600 text-white font-black py-3 rounded-xl shadow-lg uppercase text-[10px]">Guardar Producto</button>
                    </div>
                </div>
                <div class="col-span-3 bg-white rounded-3xl shadow-lg border border-gray-100 overflow-hidden">
                    <table class="table-rainbow w-full">
                        <thead>
                            <tr><th>Proveedor</th><th>Marca</th><th>Modelo</th><th>Precio $</th><th>Acción</th></tr>
                        </thead>
                        <tbody id="listaProductos"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        let db = JSON.parse(localStorage.getItem('moto_jesus_v22')) || {
            caja: {
                filas: Array(12).fill().map(() => ({fact:'', ced:'', cli:'', usd:0, bsE:0, deb:0, pm:0})),
                cuentas: Array(4).fill().map(() => ({desc:'', monto:0})),
                gastos: Array(4).fill().map(() => ({desc:'', monto:0})),
                ingresos: Array(3).fill().map(() => ({desc:'', monto:0})),
                billetes: {100:0, 50:0, 20:0, 10:0, 5:0, 2:0, 1:0}
            },
            productos: []
        };

        function switchTab(id) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById('page-'+id).classList.add('active');
            document.getElementById('tab-'+id).classList.add('active');
            if(id === 'inv') renderInv();
        }

        // VALIDACIÓN CÉDULA 7-8 DÍGITOS
        function validarCedula(i, val) {
            if(!val) return;
            if(val.length < 7 || val.length > 8) {
                alert("La cédula debe tener entre 7 y 8 dígitos.");
                db.caja.filas[i].ced = "";
                calcular();
                return;
            }
            db.caja.filas[i].ced = val;
            calcular();
        }

        function calcular() {
            const tasa = parseFloat(document.getElementById('tasa').value) || 1;
            let tUsd=0, tBs=0, tFUsd=0;
            const tb = document.getElementById('cuerpoVentas'); tb.innerHTML = "";

            db.caja.filas.forEach((f, i) => {
                const filaBs = (f.bsE||0)+(f.deb||0)+(f.pm||0);
                const totalF = (f.usd||0) + (filaBs / tasa);
                tUsd += (f.usd||0); tBs += filaBs; tFUsd += totalF;
                
                tb.innerHTML += `<tr>
                    <td><input class="input-glow" value="${f.fact}" onchange="upd(${i},'fact',this.value)"></td>
                    <td><input class="input-glow border border-indigo-100 rounded" type="number" value="${f.ced}" onchange="validarCedula(${i},this.value)"></td>
                    <td><input class="input-glow text-left px-2" value="${f.cli}" onchange="upd(${i},'cli',this.value)"></td>
                    <td><input class="input-glow text-blue-600 font-bold" type="number" value="${f.usd||''}" onchange="upd(${i},'usd',parseFloat(this.value))"></td>
                    <td><input class="input-glow" type="number" value="${f.bsE||''}" onchange="upd(${i},'bsE',parseFloat(this.value))"></td>
                    <td><input class="input-glow" type="number" value="${f.deb||''}" onchange="upd(${i},'deb',parseFloat(this.value))"></td>
                    <td><input class="input-glow" type="number" value="${f.pm||''}" onchange="upd(${i},'pm',parseFloat(this.value))"></td>
                    <td class="font-bold text-pink-600 text-center">${filaBs.toFixed(2)}</td>
                    <td class="font-black text-indigo-700 text-center">${totalF.toFixed(2)}</td>
                </tr>`;
            });
            document.getElementById('pieVentas').innerHTML = `<td colspan="3" class="p-2">TOTALES</td><td>${tUsd.toFixed(2)}</td><td colspan="3"></td><td>${tBs.toLocaleString()}</td><td>${tFUsd.toFixed(2)}</td>`;

            // Billetes, Gastos y Diferencia
            let tMano = 0; const sb = document.getElementById('billetes'); sb.innerHTML = "";
            [100, 50, 20, 10, 5, 2, 1].forEach(d => {
                const c = db.caja.billetes[d] || 0; tMano += (c * d);
                sb.innerHTML += `<div class="flex justify-between border-b border-indigo-900/30"><span>${d}$</span><input type="number" class="w-8 text-white font-black" value="${c||''}" onchange="updB(${d},parseInt(this.value))"></div>`;
            });
            document.getElementById('resFisico').innerText = tMano.toFixed(2);
            
            // SECCIÓN DE DEUDAS Y GASTOS (IGUAL A TU CÓDIGO)
            let tCuentas = 0; const sc = document.getElementById('seccionCuentas'); sc.innerHTML = "";
            db.caja.cuentas.forEach((c, i) => { tCuentas += (c.monto||0); sc.innerHTML += `<div class="flex gap-1"><input class="flex-1 text-left bg-white/40 p-1 rounded italic" value="${c.desc}" onchange="updExtra('cuentas',${i},'desc',this.value)"><input type="number" class="w-16 bg-white/60 p-1 rounded font-bold" value="${c.monto||''}" onchange="updExtra('cuentas',${i},'monto',parseFloat(this.value))"></div>`; });
            document.getElementById('totalCuentas').innerText = tCuentas.toFixed(2);

            const diff = tMano - tUsd;
            document.getElementById('statusNum').innerText = Math.abs(diff).toFixed(2);
            document.getElementById('statusTxt').innerText = Math.abs(diff) < 0.01 ? "CUADRADO ✅" : (diff > 0 ? "SOBRANTE ⚠️" : "FALTANTE ❌");
            document.getElementById('statusNum').className = "text-6xl font-black mb-1 " + (Math.abs(diff) < 0.01 ? "text-green-400" : "text-red-400");
            
            localStorage.setItem('moto_jesus_v22', JSON.stringify(db));
        }

        // FUNCIONES DE INVENTARIO
        function agregarProducto() {
            const p = { prov: document.getElementById('p-prov').value, mar: document.getElementById('p-marca').value, mod: document.getElementById('p-modelo').value, pre: parseFloat(document.getElementById('p-precio').value) };
            if(!p.mar || isNaN(p.pre)) return alert("Mínimo Marca y Precio");
            db.productos.push(p);
            renderInv();
            document.getElementById('p-prov').value = ""; document.getElementById('p-marca').value = ""; document.getElementById('p-modelo').value = ""; document.getElementById('p-precio').value = "";
        }

        function renderInv() {
            const list = document.getElementById('listaProductos');
            list.innerHTML = db.productos.map((p, i) => `<tr><td>${p.prov}</td><td>${p.mar}</td><td>${p.mod}</td><td>$${p.pre.toFixed(2)}</td><td><i class="fas fa-trash text-red-500 cursor-pointer" onclick="delPro(${i})"></i></td></tr>`).join('');
            localStorage.setItem('moto_jesus_v22', JSON.stringify(db));
        }

        function upd(i,k,v) { db.caja.filas[i][k] = v; calcular(); }
        function updExtra(type,i,k,v) { db.caja[type][i][k] = v; calcular(); }
        function updB(d,v) { db.caja.billetes[d] = v; calcular(); }
        function delPro(i) { db.productos.splice(i,1); renderInv(); }
        function limpiarTodo() { if(confirm("¿Borrar todo?")) { localStorage.removeItem('moto_jesus_v22'); location.reload(); } }

        calcular();
    </script>
</body>
</html>

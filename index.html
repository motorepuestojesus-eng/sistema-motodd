<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>SISTEMA POS v26 - MOTO REPUESTOS JESÚS</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root { --bg: #0f172a; --card: #1e293b; --accent: #38bdf8; --text: #f1f5f9; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; }
        body { background: var(--bg); color: var(--text); display: flex; height: 100vh; overflow: hidden; }
        
        .sidebar { width: 260px; background: var(--card); border-right: 1px solid #334155; display: flex; flex-direction: column; }
        .nav-btn { padding: 16px 25px; color: #94a3b8; cursor: pointer; border: none; background: none; width: 100%; text-align: left; display: flex; align-items: center; gap: 15px; }
        .nav-btn.active { background: #334155; color: white; border-left: 4px solid var(--accent); }

        .main { flex: 1; padding: 25px; overflow-y: auto; background: #f3f4f6; }
        .page { display: none; }
        .page.active { display: block; }

        /* TABLA CUADRE (IMAGEN 3) */
        .glass-jesus { background: white; border-radius: 2.5rem; padding: 30px; color: #1e293b; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        .table-rainbow th { background: linear-gradient(90deg, #4f46e5, #ec4899); color: white; padding: 10px; font-size: 10px; text-transform: uppercase; }
        .input-j { background: transparent; text-align: center; font-weight: 700; width: 100%; outline: none; border-bottom: 1px solid #eee; }
        
        /* CUADRO EXCEL BS (IMAGEN 4) */
        .excel-bs { background: white; border: 2px solid #000; color: black; }
        .excel-bs td, .excel-bs th { border: 1px solid #ccc; padding: 4px; font-size: 13px; }
        .bg-yellow-excel { background: #ffff00; font-weight: bold; }

        /* VENTANAS MODALES */
        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.8); align-items: center; justify-content: center; z-index: 100; }
        .modal-content { background: var(--card); padding: 30px; border-radius: 20px; width: 400px; border: 1px solid var(--accent); }
    </style>
</head>
<body>

    <div id="modal-cli" class="modal">
        <div class="modal-content">
            <h2 class="text-xl font-bold mb-4 text-sky-400">Nuevo Cliente</h2>
            <input type="number" id="m-ced" class="w-full bg-slate-900 p-2 rounded mb-3" placeholder="Cédula">
            <input type="text" id="m-nom" class="w-full bg-slate-900 p-2 rounded mb-3" placeholder="Nombre Completo">
            <input type="text" id="m-dir" class="w-full bg-slate-900 p-2 rounded mb-3" placeholder="Dirección">
            <div class="flex gap-2">
                <button class="flex-1 bg-emerald-600 p-2 rounded font-bold" onclick="confirmarCli()">GUARDAR</button>
                <button class="flex-1 bg-red-600 p-2 rounded font-bold" onclick="cerrarModal('modal-cli')">SALIR / CANCELAR</button>
            </div>
        </div>
    </div>

    <nav class="sidebar">
        <div class="p-8 text-xl font-black text-sky-400 italic">MOTO JESÚS</div>
        <button class="nav-btn active" onclick="tab('pos')"><i class="fas fa-shopping-cart"></i> Ventas</button>
        <button class="nav-btn" onclick="tab('inv')"><i class="fas fa-boxes"></i> Inventario</button>
        <button class="nav-btn" onclick="tab('cuadre')"><i class="fas fa-cash-register"></i> Cuadre de Caja</button>
    </nav>

    <main class="main">
        
        <div id="tab-pos" class="page active">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="md:col-span-2">
                    <div class="bg-slate-800 p-6 rounded-2xl shadow-lg border border-slate-700">
                        <label class="text-xs text-slate-400 uppercase font-bold">Cédula del Cliente (Enter)</label>
                        <input type="number" id="c-ced" class="w-full bg-slate-950 p-3 rounded-xl border border-slate-600 text-white mt-1" onkeydown="verificarCliente(event)">
                        <div id="info-cli-v" class="hidden mt-4 p-4 bg-sky-900/30 border border-sky-500 rounded-xl">
                            <b id="v-nom" class="block text-sky-400"></b>
                            <small id="v-dir" class="text-slate-300"></small>
                        </div>
                    </div>
                </div>
                <div class="bg-slate-800 p-6 rounded-2xl shadow-lg text-center">
                    <h1 id="total-v" class="text-6xl font-black text-sky-400 mb-4">$0.00</h1>
                    <button class="w-full bg-emerald-500 py-4 rounded-xl font-black text-white shadow-lg">PROCESAR VENTA</button>
                </div>
            </div>
        </div>

        <div id="tab-inv" class="page">
            <div class="glass-jesus">
                <h2 class="text-2xl font-bold mb-6 text-indigo-900 uppercase italic">Registro de Inventario</h2>
                <div class="grid grid-cols-2 md:grid-cols-5 gap-4 mb-8">
                    <div><label class="text-[10px] font-bold">PROVEEDOR</label><input type="text" id="i-prov" class="input-j text-left"></div>
                    <div><label class="text-[10px] font-bold">MARCA</label><input type="text" id="i-marca" class="input-j text-left"></div>
                    <div><label class="text-[10px] font-bold">MODELO</label><input type="text" id="i-modelo" class="input-j text-left"></div>
                    <div><label class="text-[10px] font-bold">PRODUCTO</label><input type="text" id="i-prod" class="input-j text-left"></div>
                    <div><label class="text-[10px] font-bold">PRECIO ($)</label><input type="number" id="i-prec" class="input-j"></div>
                </div>
                <div class="flex gap-4">
                    <button class="bg-indigo-600 text-white px-6 py-2 rounded-full font-bold shadow-lg" onclick="saveInv()">GUARDAR PRODUCTO</button>
                    <button class="bg-gray-400 text-white px-6 py-2 rounded-full font-bold shadow-lg" onclick="limpiarInv()">LIMPIAR / SALIR</button>
                </div>
            </div>
        </div>

        <div id="tab-cuadre" class="page">
            <div class="glass-jesus">
                <div class="flex justify-between items-center mb-6">
                    <h1 class="text-3xl font-black text-indigo-900 italic uppercase italic">Moto Repuestos Jesús</h1>
                    <div class="bg-indigo-600 px-4 py-1 rounded-xl text-white text-center">
                        <span class="text-[9px] font-bold block opacity-70">TASA BCV</span>
                        <input type="number" id="tasa-j" value="54.20" class="bg-transparent text-xl font-black w-16 text-center outline-none" onchange="renderCaja()">
                    </div>
                </div>

                <div class="overflow-hidden rounded-3xl border border-gray-100 mb-8 shadow-sm">
                    <table class="w-full text-sm">
                        <thead class="table-rainbow">
                            <tr><th>Factura</th><th>Cliente</th><th>$ Efectivo</th><th>Bs Efectivo</th><th>Débito</th><th>Pago Móvil</th><th class="bg-pink-500">Sub-Total Bs</th><th class="bg-indigo-900">Total $</th></tr>
                        </thead>
                        <tbody id="cuerpo-caja"></tbody>
                    </table>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div class="space-y-6">
                        <div class="grid grid-cols-2 gap-4">
                            <div class="bg-blue-50 p-4 rounded-3xl border border-blue-100">
                                <h3 class="text-[10px] font-black uppercase text-blue-700 mb-2 italic">Cuentas por Cobrar ($)</h3>
                                <div id="ctas-usd" class="space-y-1"></div>
                            </div>
                            <div class="bg-red-50 p-4 rounded-3xl border border-red-100">
                                <h3 class="text-[10px] font-black uppercase text-red-700 mb-2 italic">Gastos / Egresos ($)</h3>
                                <div id="gastos-usd" class="space-y-1"></div>
                            </div>
                        </div>
                        <div class="bg-slate-900 p-6 rounded-[2.5rem] text-white">
                            <div class="flex justify-between items-center mb-4"><span class="text-xs font-bold text-sky-400 uppercase tracking-tighter">Diferencia Divisas $</span><div id="diff-usd" class="text-4xl font-black text-emerald-400">0.00</div></div>
                            <div id="billetes-grid" class="grid grid-cols-2 gap-x-8 gap-y-1 text-xs"></div>
                        </div>
                    </div>

                    <div>
                        <table class="excel-bs w-full">
                            <thead>
                                <tr><th colspan="2" class="py-2 uppercase font-black">Total ctas x cobrar y Gastos</th></tr>
                                <tr><th colspan="2" class="py-1">SALDO PARA ENTREGAR</th></tr>
                            </thead>
                            <tbody>
                                <tr class="bg-yellow-excel"><td>Efectivo Bs</td><td id="ef-bs" class="text-right">0,00</td></tr>
                                <tr><td colspan="2" class="bg-gray-50 font-bold text-center">Detalle Gastos Bs</td></tr>
                                <tbody id="filas-bs-excel"></tbody>
                                <tr class="font-bold"><td>Total gastos Bs</td><td id="tot-g-bs" class="text-right">0,00</td></tr>
                                <tr class="border-t-2 border-black"><td>Total Efectivo</td><td id="fin-ef-bs" class="text-right">0,00</td></tr>
                                <tr><td>Total Gastos en Bs</td><td id="fin-g-bs" class="text-right">0,00</td></tr>
                                <tr class="bg-gray-100 font-black"><td>Efectivo menos gastos Bs</td><td id="neto-bs" class="text-right">0,00</td></tr>
                                <tr><td>Total entre tasa ($)</td><td id="neto-tasa" class="text-right text-blue-700 font-bold">0,00</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        let data = JSON.parse(localStorage.getItem('moto_db_v26')) || {
            cli: [], inv: [],
            caja: Array(8).fill().map(() => ({fact:'', cli:'', usd:0, bsE:0, deb:0, pm:0})),
            usd_c: Array(3).fill().map(() => ({n:'', m:0})),
            usd_g: Array(3).fill().map(() => ({n:'', m:0})),
            bs_g: Array(6).fill().map(() => ({n:'', m:0})),
            bill: {100:0, 50:0, 20:0, 10:0, 5:0, 2:0, 1:0}
        };

        function tab(id) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            document.getElementById('tab-'+id).classList.add('active');
            event.currentTarget.classList.add('active');
            if(id === 'cuadre') renderCaja();
        }

        // --- CLIENTES CON DIRECCIÓN ---
        function verificarCliente(e) {
            if(e.key === 'Enter') {
                let ced = e.target.value;
                let c = data.cli.find(x => x.ced === ced);
                if(c) { 
                    mostrarCliVenta(c); 
                } else {
                    document.getElementById('m-ced').value = ced;
                    document.getElementById('modal-cli').style.display = 'flex';
                }
            }
        }
        function confirmarCli() {
            let nc = { 
                ced: document.getElementById('m-ced').value, 
                nom: document.getElementById('m-nom').value, 
                dir: document.getElementById('m-dir').value 
            };
            if(!nc.nom || !nc.dir) return alert("Nombre y Dirección son obligatorios");
            data.cli.push(nc); save(); cerrarModal('modal-cli'); mostrarCliVenta(nc);
        }
        function mostrarCliVenta(c) {
            document.getElementById('info-cli-v').classList.remove('hidden');
            document.getElementById('v-nom').innerText = c.nom;
            document.getElementById('v-dir').innerText = c.dir;
        }

        // --- INVENTARIO COMPLETO ---
        function saveInv() {
            let p = {
                prov: document.getElementById('i-prov').value,
                marca: document.getElementById('i-marca').value,
                mod: document.getElementById('i-modelo').value,
                prod: document.getElementById('i-prod').value,
                prec: parseFloat(document.getElementById('i-prec').value)
            };
            if(!p.marca || !p.prec) return alert("Marca y Precio obligatorios");
            data.inv.push(p); save(); alert("Producto Guardado"); limpiarInv();
        }
        function limpiarInv() { ['i-prov','i-marca','i-modelo','i-prod','i-prec'].forEach(i => document.getElementById(i).value = ''); }

        // --- CUADRE CAJA (BS Y $) ---
        function renderCaja() {
            const tasa = parseFloat(document.getElementById('tasa-j').value) || 1;
            let sistemaUsd = 0; let efBsVentas = 0;

            // Tabla Ventas
            document.getElementById('cuerpo-caja').innerHTML = data.caja.map((f, i) => {
                const subBs = (f.bsE||0)+(f.deb||0)+(f.pm||0);
                const totUsd = (f.usd||0)+(subBs/tasa);
                sistemaUsd += totUsd; efBsVentas += (f.bsE||0);
                return `<tr>
                    <td><input class="input-j" value="${f.fact}" onchange="updC(${i},'fact',this.value)"></td>
                    <td><input class="input-j text-left" value="${f.cli}" onchange="updC(${i},'cli',this.value)"></td>
                    <td><input class="input-j text-blue-600" type="number" value="${f.usd||''}" onchange="updC(${i},'usd',parseFloat(this.value))"></td>
                    <td><input class="input-j" type="number" value="${f.bsE||''}" onchange="updC(${i},'bsE',parseFloat(this.value))"></td>
                    <td><input class="input-j" type="number" value="${f.deb||''}" onchange="updC(${i},'deb',parseFloat(this.value))"></td>
                    <td><input class="input-j" type="number" value="${f.pm||''}" onchange="updC(${i},'pm',parseFloat(this.value))"></td>
                    <td class="text-center font-bold text-pink-500">${subBs.toLocaleString()}</td>
                    <td class="text-center font-black text-indigo-900">${totUsd.toFixed(2)}</td>
                </tr>`;
            }).join('');

            // Otros USD
            document.getElementById('ctas-usd').innerHTML = data.usd_c.map((c, i) => `<div class="flex gap-1"><input class="input-j text-[10px] text-left" placeholder="Nombre..." value="${c.n}" onchange="updE('usd_c',${i},'n',this.value)"><input type="number" class="w-10 text-xs font-bold" value="${c.m||''}" onchange="updE('usd_c',${i},'m',parseFloat(this.value))"></div>`).join('');
            document.getElementById('gastos-usd').innerHTML = data.usd_g.map((g, i) => `<div class="flex gap-1"><input class="input-j text-[10px] text-left" placeholder="Gasto..." value="${g.n}" onchange="updE('usd_g',${i},'n',this.value)"><input type="number" class="w-10 text-xs font-bold" value="${g.m||''}" onchange="updE('usd_g',${i},'m',parseFloat(this.value))"></div>`).join('');

            // Excel BS [cite: 2026-01-09]
            let sumGBs = 0;
            document.getElementById('filas-bs-excel').innerHTML = data.bs_g.map((g, i) => {
                sumGBs += (g.m||0);
                return `<tr><td><input class="w-full outline-none" value="${g.n}" onchange="updE('bs_g',${i},'n',this.value)"></td><td class="text-right"><input type="number" class="w-full text-right outline-none" value="${g.m||''}" onchange="updE('bs_g',${i},'m',parseFloat(this.value))"></td></tr>`;
            }).join('');
            document.getElementById('ef-bs').innerText = efBsVentas.toLocaleString();
            document.getElementById('tot-g-bs').innerText = sumGBs.toLocaleString();
            document.getElementById('fin-ef-bs').innerText = efBsVentas.toLocaleString();
            document.getElementById('fin-g-bs').innerText = sumGBs.toLocaleString();
            document.getElementById('neto-bs').innerText = (efBsVentas - sumGBs).toLocaleString();
            document.getElementById('neto-tasa').innerText = ((efBsVentas - sumGBs)/tasa).toFixed(2);

            // Billetes y Diferencia
            let fis = 0; const grid = document.getElementById('billetes-grid'); grid.innerHTML = "";
            [100,50,20,10,5,2,1].forEach(v => {
                let c = data.bill[v]||0; fis += (v*c);
                grid.innerHTML += `<div class="flex justify-between border-b border-slate-700 py-1"><span>${v}$</span><input type="number" class="bg-transparent w-8 text-right text-sky-400 font-bold" value="${c||''}" onchange="updB(${v},parseInt(this.value))"></div>`;
            });
            document.getElementById('diff-usd').innerText = (fis - sistemaUsd).toFixed(2);
            save();
        }

        function updC(i,k,v) { data.caja[i][k] = v; renderCaja(); }
        function updE(t,i,k,v) { data[t][i][k] = v; renderCaja(); }
        function updB(v,c) { data.bill[v] = c; renderCaja(); }
        function cerrarModal(id) { document.getElementById(id).style.display = 'none'; }
        function save() { localStorage.setItem('moto_db_v26', JSON.stringify(data)); }
        
        renderCaja();
    </script>
</body>
</html>

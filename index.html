<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SISTEMA POS ELITE v5.0 | Gesti√≥n Avanzada</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #0f172a; --secondary: #1e293b; --accent: #38bdf8;
            --success: #22c55e; --danger: #ef4444; --text: #f8fafc; --muted: #64748b;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }
        body { background: var(--primary); color: var(--text); display: flex; height: 100vh; }

        /* Sidebar */
        .sidebar { width: 260px; background: var(--secondary); border-right: 1px solid #334155; display: flex; flex-direction: column; }
        .logo { padding: 25px; font-weight: 800; font-size: 1.2rem; color: var(--accent); border-bottom: 1px solid #334155; display: flex; align-items: center; gap: 10px; }
        .nav-link { padding: 15px 25px; color: #94a3b8; cursor: pointer; transition: 0.2s; border: none; background: none; width: 100%; text-align: left; display: flex; align-items: center; gap: 12px; }
        .nav-link:hover, .nav-link.active { background: #334155; color: white; border-left: 4px solid var(--accent); }

        /* Main Content */
        .main { flex-grow: 1; padding: 30px; overflow-y: auto; background-image: radial-gradient(circle at top right, #1e293b, #0f172a); }
        .page { display: none; animation: fadeIn 0.3s ease; }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* Cards & UI */
        .card { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(10px); padding: 25px; border-radius: 16px; border: 1px solid #334155; margin-bottom: 25px; }
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        
        /* Inputs Pro */
        .input-group { margin-bottom: 15px; }
        .input-group label { display: block; margin-bottom: 5px; font-size: 0.85rem; color: var(--muted); }
        input, select { width: 100%; padding: 12px; background: #0f172a; border: 1px solid #334155; color: white; border-radius: 10px; font-size: 1rem; transition: 0.3s; }
        input:focus { border-color: var(--accent); outline: none; box-shadow: 0 0 0 3px rgba(56, 189, 248, 0.2); }

        /* Buttons */
        .btn { padding: 12px 20px; border-radius: 10px; border: none; cursor: pointer; font-weight: 600; display: inline-flex; align-items: center; gap: 8px; transition: 0.2s; }
        .btn-primary { background: var(--accent); color: var(--primary); }
        .btn-primary:hover { background: #7dd3fc; }
        .btn-danger { background: rgba(239, 68, 68, 0.1); color: var(--danger); border: 1px solid var(--danger); }
        .btn-danger:hover { background: var(--danger); color: white; }

        /* Table Design */
        table { width: 100%; border-collapse: separate; border-spacing: 0 8px; }
        th { padding: 12px; text-align: left; color: var(--muted); font-size: 0.8rem; text-transform: uppercase; letter-spacing: 1px; }
        td { padding: 16px; background: #1e293b; border-top: 1px solid #334155; border-bottom: 1px solid #334155; }
        td:first-child { border-left: 1px solid #334155; border-radius: 12px 0 0 12px; }
        td:last-child { border-right: 1px solid #334155; border-radius: 0 12px 12px 0; }

        /* POS Styles */
        .pos-container { display: grid; grid-template-columns: 1fr 380px; gap: 25px; }
        .search-client-pos { position: relative; }
        .client-dropdown { position: absolute; top: 100%; left: 0; right: 0; background: #1e293b; border: 1px solid var(--accent); z-index: 100; border-radius: 0 0 10px 10px; max-height: 200px; overflow-y: auto; display: none; }
        .client-opt { padding: 10px; cursor: pointer; border-bottom: 1px solid #334155; }
        .client-opt:hover { background: var(--primary); color: var(--accent); }
    </style>
</head>
<body>

    <nav class="sidebar">
        <div class="logo"><i class="fas fa-bolt"></i> NEXUS RETAIL</div>
        <button class="nav-link active" onclick="showPage('pos')"><i class="fas fa-terminal"></i> Terminal POS</button>
        <button class="nav-link" onclick="showPage('clientes')"><i class="fas fa-address-book"></i> Directorio Clientes</button>
        <button class="nav-link" onclick="showPage('inventario')"><i class="fas fa-boxes-stacked"></i> Inventario</button>
        <button class="nav-link" onclick="showPage('historial')"><i class="fas fa-receipt"></i> Historial</button>
    </nav>

    <main class="main">
        <div id="page-clientes" class="page">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                <h2>Directorio Central de Clientes</h2>
                <div style="width: 300px;">
                    <input type="text" id="cli-search" placeholder="üîç Buscar por nombre o c√©dula..." onkeyup="filterClientes()">
                </div>
            </div>

            <div class="card">
                <h3 style="margin-bottom:15px;">Registrar / Editar Cliente</h3>
                <div class="grid-2">
                    <div class="input-group">
                        <label>C√©dula o Identificaci√≥n Fiscal</label>
                        <input type="text" id="c-cedula" placeholder="Ej: 25.123.456">
                    </div>
                    <div class="input-group">
                        <label>Nombre Completo</label>
                        <input type="text" id="c-nombre" placeholder="Ej: Juan P√©rez">
                    </div>
                    <div class="input-group">
                        <label>Tel√©fono de Contacto</label>
                        <input type="text" id="c-telefono" placeholder="Ej: +58 412...">
                    </div>
                    <div class="input-group">
                        <label>Direcci√≥n de Domicilio</label>
                        <input type="text" id="c-direccion" placeholder="Ej: Av. Principal Local 5">
                    </div>
                </div>
                <div style="margin-top:10px; display:flex; gap:10px;">
                    <button class="btn btn-primary" onclick="guardarCliente()"><i class="fas fa-save"></i> Guardar Cliente</button>
                    <button class="btn btn-danger" onclick="limpiarFormCliente()">Limpiar Formulario</button>
                </div>
            </div>

            <div class="card">
                <table>
                    <thead>
                        <tr><th>Identificaci√≥n</th><th>Cliente</th><th>Tel√©fono</th><th>Ubicaci√≥n</th><th>Acciones</th></tr>
                    </thead>
                    <tbody id="tabla-clientes"></tbody>
                </table>
            </div>
        </div>

        <div id="page-pos" class="page active">
            <div class="pos-container">
                <div>
                    <div class="card">
                        <input type="text" id="pos-search-prod" placeholder="Escanear producto..." onkeyup="renderPOS()">
                        <div id="pos-grid" style="display:grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap:15px; margin-top:20px;"></div>
                    </div>
                </div>
                
                <div class="card" style="display:flex; flex-direction:column; height: 80vh;">
                    <h3>Nueva Transacci√≥n</h3>
                    <div class="search-client-pos" style="margin-top:15px;">
                        <input type="text" id="pos-cli-input" placeholder="Escribe c√©dula o nombre del cliente..." onkeyup="posSearchClient(this.value)">
                        <div id="pos-client-list" class="client-dropdown"></div>
                    </div>
                    <div id="selected-client-badge" style="margin:10px 0; padding:10px; background:rgba(56, 189, 248, 0.1); border-radius:8px; display:none;">
                        <i class="fas fa-user-check"></i> <span id="active-cli-name"></span>
                    </div>

                    <div id="pos-cart" style="flex-grow:1; overflow-y:auto; border-top:1px solid #334155; margin-top:10px; padding-top:10px;"></div>
                    
                    <div style="border-top:2px solid var(--accent); padding-top:20px;">
                        <div style="display:flex; justify-content:space-between; font-size:1.8rem; font-weight:900;">
                            <span>TOTAL:</span> <span id="pos-total">$0.00</span>
                        </div>
                        <button class="btn btn-primary" style="width:100%; justify-content:center; margin-top:15px; padding:18px;" onclick="finalizarVenta()">
                            PROCESAR PAGO <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        let db = {
            clientes: JSON.parse(localStorage.getItem('sys_cli')) || [],
            productos: JSON.parse(localStorage.getItem('sys_prod')) || [],
            ventas: JSON.parse(localStorage.getItem('sys_ven')) || [],
            carrito: [],
            clienteActual: null
        };

        function showPage(id) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
            document.getElementById('page-' + id).classList.add('active');
            event.currentTarget.classList.add('active');
            renderAll();
        }

        // --- L√ìGICA DE CLIENTES (USABILIDAD) ---
        function guardarCliente() {
            const cedula = document.getElementById('c-cedula').value.trim();
            const nombre = document.getElementById('c-nombre').value.trim();
            
            if(!cedula || !nombre) return alert("C√©dula y Nombre son requeridos");

            // Evitar duplicados por c√©dula
            const index = db.clientes.findIndex(c => c.cedula === cedula);
            const clienteData = {
                cedula, 
                nombre, 
                tel: document.getElementById('c-telefono').value,
                dir: document.getElementById('c-direccion').value
            };

            if(index > -1) {
                db.clientes[index] = clienteData; // Actualizar
                alert("Datos del cliente actualizados");
            } else {
                db.clientes.push(clienteData); // Crear
                alert("Cliente registrado con √©xito");
            }

            guardar();
            limpiarFormCliente();
            renderAll();
        }

        function editarCliente(cedula) {
            const c = db.clientes.find(x => x.cedula === cedula);
            document.getElementById('c-cedula').value = c.cedula;
            document.getElementById('c-nombre').value = c.nombre;
            document.getElementById('c-telefono').value = c.tel;
            document.getElementById('c-direccion').value = c.dir;
            document.getElementById('c-nombre').focus();
        }

        function eliminarCliente(cedula) {
            if(confirm("¬øSeguro que desea eliminar este cliente?")) {
                db.clientes = db.clientes.filter(c => c.cedula !== cedula);
                guardar();
                renderAll();
            }
        }

        function filterClientes() {
            const busqueda = document.getElementById('cli-search').value.toLowerCase();
            const filtrados = db.clientes.filter(c => 
                c.nombre.toLowerCase().includes(busqueda) || c.cedula.includes(busqueda)
            );
            renderTablaClientes(filtrados);
        }

        // --- USABILIDAD EN POS (AUTOCOMPLETADO) ---
        function posSearchClient(val) {
            const list = document.getElementById('pos-client-list');
            if(!val) { list.style.display = 'none'; return; }
            
            const matches = db.clientes.filter(c => 
                c.nombre.toLowerCase().includes(val.toLowerCase()) || c.cedula.includes(val)
            );

            if(matches.length > 0) {
                list.innerHTML = matches.map(c => `
                    <div class="client-opt" onclick="seleccionarClientePOS('${c.cedula}')">
                        <b>${c.nombre}</b> <small>(${c.cedula})</small>
                    </div>
                `).join('');
                list.style.display = 'block';
            } else {
                list.innerHTML = `<div class="client-opt" onclick="showPage('clientes')">‚ûï Cliente no existe. Registrar nuevo</div>`;
                list.style.display = 'block';
            }
        }

        function seleccionarClientePOS(cedula) {
            const c = db.clientes.find(x => x.cedula === cedula);
            db.clienteActual = c;
            document.getElementById('active-cli-name').innerText = c.nombre;
            document.getElementById('selected-client-badge').style.display = 'block';
            document.getElementById('pos-client-list').style.display = 'none';
            document.getElementById('pos-cli-input').value = '';
        }

        // --- FUNCIONES CORE ---
        function guardar() {
            localStorage.setItem('sys_cli', JSON.stringify(db.clientes));
            localStorage.setItem('sys_prod', JSON.stringify(db.productos));
            localStorage.setItem('sys_ven', JSON.stringify(db.ventas));
        }

        function renderTablaClientes(data = db.clientes) {
            const tbody = document.getElementById('tabla-clientes');
            tbody.innerHTML = data.map(c => `
                <tr>
                    <td><b>${c.cedula}</b></td>
                    <td>${c.nombre}</td>
                    <td>${c.tel}</td>
                    <td>${c.dir}</td>
                    <td>
                        <button class="btn btn-primary" onclick="editarCliente('${c.cedula}')"><i class="fas fa-edit"></i></button>
                        <button class="btn btn-danger" onclick="eliminarCliente('${c.cedula}')"><i class="fas fa-trash"></i></button>
                    </td>
                </tr>
            `).join('');
        }

        function limpiarFormCliente() {
            document.getElementById('c-cedula').value = '';
            document.getElementById('c-nombre').value = '';
            document.getElementById('c-telefono').value = '';
            document.getElementById('c-direccion').value = '';
        }

        function renderAll() {
            renderTablaClientes();
            // L√≥gica para POS grid
            const grid = document.getElementById('pos-grid');
            grid.innerHTML = db.productos.map(p => `
                <div class="client-opt" style="border:1px solid #334155; border-radius:10px; text-align:center;" onclick="addToCart(${p.id})">
                    <b>${p.nombre}</b><br>$${p.precio}<br><small>Stock: ${p.stock}</small>
                </div>
            `).join('');
        }

        // Inicializaci√≥n
        renderAll();
    </script>
</body>
</html>

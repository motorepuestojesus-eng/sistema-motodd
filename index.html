<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FRANQUICIA MASTER POS | Sistema de Control Global</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #0f172a; --secondary: #1e293b; --accent: #38bdf8;
            --success: #22c55e; --danger: #ef4444; --text: #f8fafc;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
        body { background: var(--primary); color: var(--text); display: flex; height: 100vh; }

        /* Sidebar Navegación */
        .sidebar { width: 280px; background: var(--secondary); border-right: 2px solid #334155; display: flex; flex-direction: column; }
        .logo { padding: 30px; text-align: center; font-weight: 800; font-size: 1.5rem; color: var(--accent); border-bottom: 1px solid #334155; }
        .nav-link { padding: 20px; color: #94a3b8; cursor: pointer; transition: 0.3s; display: flex; align-items: center; gap: 15px; border: none; background: none; width: 100%; font-size: 1rem; }
        .nav-link:hover, .nav-link.active { background: #334155; color: white; border-left: 5px solid var(--accent); }

        /* Contenedor Principal */
        .main { flex-grow: 1; padding: 30px; overflow-y: auto; }
        .page { display: none; animation: slideIn 0.3s ease-out; }
        .page.active { display: block; }
        @keyframes slideIn { from { opacity: 0; transform: translateX(20px); } to { opacity: 1; transform: translateX(0); } }

        /* Formularios y Tablas */
        .card { background: var(--secondary); padding: 25px; border-radius: 15px; border: 1px solid #334155; margin-bottom: 20px; }
        input, select { width: 100%; padding: 12px; margin: 10px 0; background: #0f172a; border: 1px solid #475569; color: white; border-radius: 8px; }
        button.btn { padding: 12px 25px; border-radius: 8px; border: none; cursor: pointer; font-weight: bold; transition: 0.2s; }
        .btn-add { background: var(--accent); color: var(--primary); }
        .btn-sale { background: var(--success); color: white; width: 100%; font-size: 1.2rem; }

        /* POS Layout */
        .pos-grid { display: grid; grid-template-columns: 1fr 400px; gap: 20px; }
        .product-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 15px; }
        .product-item { background: #334155; padding: 15px; border-radius: 10px; text-align: center; cursor: pointer; }
        .product-item:hover { border: 2px solid var(--accent); }
        
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th { background: #334155; padding: 15px; text-align: left; color: var(--accent); }
        td { padding: 15px; border-bottom: 1px solid #334155; }

        .badge { padding: 5px 10px; border-radius: 5px; font-size: 0.8rem; }
        .bg-success { background: var(--success); }
        .bg-danger { background: var(--danger); }
    </style>
</head>
<body>

    <div class="sidebar">
        <div class="logo"><i class="fas fa-university"></i> FRANQUICIA PRO</div>
        <button class="nav-link active" onclick="showPage('pos')"><i class="fas fa-shopping-cart"></i> PUNTO DE VENTA</button>
        <button class="nav-link" onclick="showPage('clientes')"><i class="fas fa-user-friends"></i> CLIENTES</button>
        <button class="nav-link" onclick="showPage('productos')"><i class="fas fa-boxes"></i> INVENTARIO</button>
        <button class="nav-link" onclick="showPage('reportes')"><i class="fas fa-chart-bar"></i> REPORTES Y VENTAS</button>
        <div style="margin-top: auto; padding: 20px;">
            <button onclick="exportarDB()" class="btn btn-add" style="width: 100%; background: #475569; color: white;">
                <i class="fas fa-download"></i> RESPALDO TOTAL
            </button>
        </div>
    </div>

    <div class="main">
        <div id="page-pos" class="page active">
            <h2 style="margin-bottom: 20px;">Terminal de Venta</h2>
            <div class="pos-grid">
                <div>
                    <div class="card">
                        <input type="text" id="search-pos" placeholder="Buscar producto..." onkeyup="filterPOS()">
                        <div class="product-list" id="pos-products"></div>
                    </div>
                </div>
                <div class="card">
                    <h3>Carrito de Venta</h3>
                    <input type="text" id="cliente-cedula-pos" placeholder="Cédula del Cliente">
                    <div id="cliente-info" style="font-size: 0.9rem; color: var(--accent); margin-bottom: 10px;">Cliente: No seleccionado</div>
                    <div id="carrito-items" style="height: 300px; overflow-y: auto; margin: 10px 0; border-top: 1px solid #334155;"></div>
                    <div style="border-top: 2px solid var(--accent); padding-top: 15px;">
                        <div style="display:flex; justify-content: space-between; margin-bottom: 10px;">
                            <span>SUBTOTAL:</span> <span id="cart-subtotal">$0.00</span>
                        </div>
                        <div style="display:flex; justify-content: space-between; font-size: 1.5rem; font-weight: 800; color: var(--accent);">
                            <span>TOTAL:</span> <span id="cart-total">$0.00</span>
                        </div>
                        <button class="btn btn-sale" onclick="finalizarVenta()">COBRAR E IMPRIMIR</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="page-clientes" class="page">
            <h2>Registro Maestro de Clientes</h2>
            <div class="card">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <input type="text" id="cli-nombre" placeholder="Nombre completo">
                    <input type="text" id="cli-cedula" placeholder="Cédula / RIF / DNI">
                    <input type="text" id="cli-tel" placeholder="Teléfono">
                    <input type="text" id="cli-dir" placeholder="Dirección">
                </div>
                <button class="btn btn-add" onclick="agregarCliente()">Registrar Nuevo Cliente</button>
            </div>
            <div class="card">
                <table>
                    <thead><tr><th>Cédula</th><th>Nombre</th><th>Teléfono</th><th>Acciones</th></tr></thead>
                    <tbody id="lista-clientes"></tbody>
                </table>
            </div>
        </div>

        <div id="page-productos" class="page">
            <h2>Inventario de Franquicia</h2>
            <div class="card">
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px;">
                    <input type="text" id="prod-nombre" placeholder="Nombre del Producto">
                    <input type="number" id="prod-precio" placeholder="Precio ($)">
                    <input type="number" id="prod-stock" placeholder="Stock Inicial">
                </div>
                <button class="btn btn-add" onclick="agregarProducto()">Añadir al Almacén</button>
            </div>
            <div class="card">
                <table>
                    <thead><tr><th>ID</th><th>Producto</th><th>Precio</th><th>Stock</th><th>Estado</th></tr></thead>
                    <tbody id="lista-productos"></tbody>
                </table>
            </div>
        </div>

        <div id="page-reportes" class="page">
            <h2>Historial de Ventas Globales</h2>
            <div class="card" style="display: flex; gap: 30px; text-align: center;">
                <div><h4>Total Vendido</h4><h2 id="rep-total" style="color: var(--success);">$0.00</h2></div>
                <div><h4>Ventas Realizadas</h4><h2 id="rep-conteo">0</h2></div>
            </div>
            <div class="card">
                <table>
                    <thead><tr><th>Fecha</th><th>Cliente</th><th>Total</th><th>Items</th></tr></thead>
                    <tbody id="lista-ventas"></tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // --- BASE DE DATOS ---
        let db = {
            clientes: JSON.parse(localStorage.getItem('f_cli')) || [],
            productos: JSON.parse(localStorage.getItem('f_prod')) || [],
            ventas: JSON.parse(localStorage.getItem('f_ven')) || [],
            carrito: []
        };

        function showPage(id) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
            document.getElementById('page-' + id).classList.add('active');
            event.currentTarget.classList.add('active');
            renderAll();
        }

        // --- CLIENTES ---
        function agregarCliente() {
            const cli = {
                nombre: document.getElementById('cli-nombre').value,
                cedula: document.getElementById('cli-cedula').value,
                tel: document.getElementById('cli-tel').value,
                dir: document.getElementById('cli-dir').value
            };
            if(!cli.nombre || !cli.cedula) return alert("Nombre y Cédula obligatorios");
            db.clientes.push(cli);
            guardar();
            alert("Cliente registrado");
        }

        // --- PRODUCTOS ---
        function agregarProducto() {
            const prod = {
                id: Date.now(),
                nombre: document.getElementById('prod-nombre').value,
                precio: parseFloat(document.getElementById('prod-precio').value),
                stock: parseInt(document.getElementById('prod-stock').value)
            };
            db.productos.push(prod);
            guardar();
            alert("Producto en almacén");
        }

        // --- PUNTO DE VENTA (POS) ---
        function agregarAlCarrito(id) {
            const p = db.productos.find(x => x.id === id);
            if(p.stock <= 0) return alert("¡SIN STOCK!");
            
            const item = db.carrito.find(x => x.id === id);
            if(item) item.cantidad++;
            else db.carrito.push({...p, cantidad: 1});
            renderCarrito();
        }

        function renderCarrito() {
            const div = document.getElementById('carrito-items');
            div.innerHTML = '';
            let total = 0;
            db.carrito.forEach((item, index) => {
                total += (item.precio * item.cantidad);
                div.innerHTML += `
                    <div style="display:flex; justify-content:space-between; padding: 10px 0; border-bottom:1px solid #475569;">
                        <span>${item.nombre} (x${item.cantidad})</span>
                        <span>$${(item.precio * item.cantidad).toFixed(2)}</span>
                    </div>
                `;
            });
            document.getElementById('cart-total').innerText = `$${total.toFixed(2)}`;
            document.getElementById('cart-subtotal').innerText = `$${(total * 0.84).toFixed(2)}`;
        }

        function finalizarVenta() {
            const cedula = document.getElementById('cliente-cedula-pos').value;
            const cliente = db.clientes.find(c => c.cedula === cedula) || {nombre: "Consumidor Final"};
            
            if(db.carrito.length === 0) return alert("Carrito vacío");

            const venta = {
                fecha: new Date().toLocaleString(),
                cliente: cliente.nombre,
                total: document.getElementById('cart-total').innerText,
                items: db.carrito.length
            };

            // Descontar Stock
            db.carrito.forEach(cartItem => {
                const p = db.productos.find(x => x.id === cartItem.id);
                p.stock -= cartItem.cantidad;
            });

            db.ventas.push(venta);
            db.carrito = [];
            guardar();
            alert("Venta procesada con éxito");
            renderAll();
        }

        // --- SISTEMA ---
        function guardar() {
            localStorage.setItem('f_cli', JSON.stringify(db.clientes));
            localStorage.setItem('f_prod', JSON.stringify(db.productos));
            localStorage.setItem('f_ven', JSON.stringify(db.ventas));
        }

        function renderAll() {
            // Render POS
            const posP = document.getElementById('pos-products');
            posP.innerHTML = db.productos.map(p => `
                <div class="product-item" onclick="agregarAlCarrito(${p.id})">
                    <b>${p.nombre}</b><br>
                    <span style="color:var(--accent)">$${p.precio}</span><br>
                    <small>Stock: ${p.stock}</small>
                </div>
            `).join('');

            // Render Clientes
            document.getElementById('lista-clientes').innerHTML = db.clientes.map(c => `
                <tr><td>${c.cedula}</td><td>${c.nombre}</td><td>${c.tel}</td><td><button onclick="alert('${c.dir}')">Ver Dir</button></td></tr>
            `).join('');

            // Render Inventario
            document.getElementById('lista-productos').innerHTML = db.productos.map(p => `
                <tr>
                    <td>#${p.id.toString().slice(-4)}</td>
                    <td>${p.nombre}</td>
                    <td>$${p.precio}</td>
                    <td>${p.stock}</td>
                    <td><span class="badge ${p.stock < 5 ? 'bg-danger' : 'bg-success'}">${p.stock < 5 ? 'BAJO' : 'OK'}</span></td>
                </tr>
            `).join('');

            // Render Reportes
            document.getElementById('lista-ventas').innerHTML = db.ventas.map(v => `
                <tr><td>${v.fecha}</td><td>${v.cliente}</td><td>${v.total}</td><td>${v.items} items</td></tr>
            `).join('');
            
            let suma = db.ventas.reduce((acc, v) => acc + parseFloat(v.total.replace('$', '')), 0);
            document.getElementById('rep-total').innerText = `$${suma.toFixed(2)}`;
            document.getElementById('rep-conteo').innerText = db.ventas.length;
        }

        function exportarDB() {
            const data = JSON.stringify(db);
            const blob = new Blob([data], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'franquicia_db.json';
            a.click();
        }

        renderAll();
    </script>
</body>
</html>
